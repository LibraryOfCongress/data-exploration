
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>LoC Data Package Tutorial: United States Elections, Web Archives Data Package &#8212; Tutorials for Data Exploration</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/loc.css?v=f609767c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Data Packages/us-elections';</script>
    <script src="../_static/loc.js?v=09f1a01c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="LoC Data Package Tutorial: Free to Use collection" href="free-to-use.html" />
    <link rel="prev" title="LoC Data Package Tutorial: Sanborn Maps collection" href="sanborn.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Tutorials for Data Exploration</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Tutorials for Data Exploration
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Loc.gov JSON API notebooks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/LOC.gov%20JSON%20API.html">LOC.gov JSON API Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/resources2pdf.html">Downloading an item with multiple pages to PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/geocoding-hhh/geocoding_with_the_hhh_collection.html">Geocoding with the HABS/HAER/HALS collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Accessing%20images%20for%20analysis.html">Accessing images from the loc.gov JSON API for image analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Dominant%20colors.html">Color clusters in images in Library of Congress collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Downloading_Monographs_as_Images_in_Rosenwald_Collection/Downloading%20Monographs%20as%20Images%20in%20Rosenwald%20Collection.html">Connecting the image file to the metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Extracting%20location%20data%20for%20geovisualization.html">Extracting location data from the loc.gov API for geovisualization</a></li>





<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/maps/maps-analyzing-metadata.html">Analyzing and visualizing cartographic metadata from loc.gov</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Chronicling America notebooks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Chronicling_America/README.html">Using the loc.gov API with the Chronicling America Historic Newspapers Collection</a></li>



<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Chronicling_America/ChronAm_basic_API%20tasks.html">Learning and Applying Basic API Tasks in Chronicling America</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Chronicling_America/ChronAm_analyzing_specific_titles_limit_results.html">Using Chronicling America to analyze specific newspaper titles for content.</a></li>


<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Chronicling_America/ChronAm_analyzing_word_frequency_newspaper_frontpages.html">Using Chronicling America to analyze word frequency in newspaper Front Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Chronicling_America/ChronAm_analyzing_language_location_frequency.html">Using Chronicling America to analyze word frequency and geographic usage</a></li>


<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Chronicling_America/ChronAm-download_results.html">Downloading Search Results from Chronicling America</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20JSON%20API/Chronicling_America/ChronAm-download_newspaper_title_batch.html">Downloading Newspaper Titles and Batches from Chronicling America</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Web Archives notebooks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Data%20Sets/Web%20Archives/getting_started_with_memegenerator.html">Exploring the Memegenerator Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Data%20Sets/Web%20Archives/getting_started_with_giphy.html">Exploring the GIPHY.com Metadata</a></li>



<li class="toctree-l1"><a class="reference internal" href="../Data%20Sets/Web%20Archives/loc_goes_lofi.html">LOC Goes Lofi</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Package notebooks</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="sanborn.html">LoC Data Package Tutorial: Sanborn Maps collection</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">LoC Data Package Tutorial: United States Elections, Web Archives Data Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="free-to-use.html">LoC Data Package Tutorial: Free to Use collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="jukebox.html">LoC Data Package Tutorial: National Jukebox collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="dot-gov-pdf.html">LoC Data Package Tutorial: 1000 Dot Gov PDF Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="digitized-books.html">LoC Data Package Tutorial: Selected Digitized Books Data Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="directories.html">LoC Data Package Tutorial: City and Telephone Directories</a></li>
<li class="toctree-l1"><a class="reference internal" href="telephone.html">LoC Data Package Tutorial: Digitized Telephone Directories Data Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="stereographs.html">LoC Data Package Tutorial: Stereograph Card Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="austro-hungarian-maps.html">LoC Data Package Tutorial: Austro-Hungarian maps set</a></li>
<li class="toctree-l1"><a class="reference internal" href="gen-coll-assessment.html">LoC Data Package Tutorial: General Collections Assessment</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Events</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Events/dh-ideas.html">Bite-size ideas for the “Doing DH @ LC” Create-a-thon</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Other Library API notebooks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20IIIF%20API/IIIF.html">IIIF API Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20Sitemaps%20API/Sitemap.html">What are Sitemaps?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../loc.gov%20web%20interface/OpenSearch.html">OpenSearch Guide</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Data Packages/us-elections.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>LoC Data Package Tutorial: United States Elections, Web Archives Data Package</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output-data-package-summary">Output data package summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#query-the-metadata-in-the-data-package">Query the metadata in the data package</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-the-metadata-fields">Interpreting the metadata fields</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-and-download-cdx-index-files-analyze-text">Filter and Download CDX index files, analyze text</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gathering-the-list-of-cdx-files">Gathering the list of CDX Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-a-sample-cdx-file">Inspect a sample CDX File</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#election-2000-dataframe">Election 2000 DataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mimetypes">Mimetypes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-by-domain">Filtering by domain</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fetching-the-text">Fetching the Text</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#top-25-words">Top 25 Words</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="loc-data-package-tutorial-united-states-elections-web-archives-data-package">
<h1>LoC Data Package Tutorial: United States Elections, Web Archives Data Package<a class="headerlink" href="#loc-data-package-tutorial-united-states-elections-web-archives-data-package" title="Link to this heading">#</a></h1>
<p><strong>Version of this notebook</strong>: 2.1</p>
<p><strong>Last run</strong>: 2025-01-17</p>
<p>This notebook will demonstrate basic usage of using Python for interacting with <a class="reference external" href="https://data.labs.loc.gov/packages/">data packages from the Library of Congress</a> via the <a class="reference external" href="https://data.labs.loc.gov/us-elections/">United States Elections, Web Archives Data Package</a> which is derived from the Library’s <a class="reference external" href="https://www.loc.gov/collections/united-states-elections-web-archive/">United States Elections Web Archive</a>. We will:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#Output-data-package-summary"><span class="xref myst">Output data package sumary</span></a></p></li>
<li><p><a class="reference internal" href="#Query-the-metadata-in-the-data-package"><span class="xref myst">Query the metadata in the data package</span></a></p></li>
<li><p><a class="reference internal" href="#Filter-and-download-CDX-index-files,-analyze-text"><span class="xref myst">Filter and download CDX index files, analyze text</span></a></p></li>
</ol>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">#</a></h2>
<p>In order to run this notebook, please follow the instructions listed in <a class="reference external" href="https://github.com/LibraryOfCongress/data-exploration/blob/master/Data%20Packages/README.md">this directory’s README</a>.</p>
</section>
<section id="output-data-package-summary">
<h2>Output data package summary<a class="headerlink" href="#output-data-package-summary" title="Link to this heading">#</a></h2>
<p>First, we will select <a class="reference external" href="https://data.labs.loc.gov/us-elections/">United States Elections, Web Archives Data Package</a> and output a summary of its files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">ast</span>  <span class="c1"># For reading structured data from metadata.csv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span> <span class="c1"># For reading remote CSV files with the pandas module</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>  <span class="c1"># For reading, manipulating, and displaying data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>  <span class="c1"># For retrieving online files</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span> <span class="c1"># For general system tasks</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_file_stats</span><span class="p">,</span> <span class="n">make_request</span>

<span class="c1"># Set general variables we&#39;ll use throughout</span>
<span class="n">DATA_URL</span> <span class="o">=</span> <span class="s1">&#39;https://data.labs.loc.gov/us-elections/&#39;</span> <span class="c1"># Base URL of this data package</span>
<span class="n">PYTHON_VERSION</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># We will use this in our request headers</span>
<span class="n">HEADERS</span> <span class="o">=</span> <span class="p">{</span> <span class="c1"># This allows us to declare ourselves to Library of Congress servers</span>
    <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s1">&#39;https://github.com/LibraryOfCongress/data-exploration/blob/master/Data Packages/us-elections.ipynb : 2.0 (python : </span><span class="si">{</span><span class="n">PYTHON_VERSION</span><span class="si">}</span><span class="s1">)&#39;</span>
    <span class="p">}</span> 

<span class="c1"># Download the file manifest</span>
<span class="n">file_manifest_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DATA_URL</span><span class="si">}</span><span class="s1">manifest.json&#39;</span>
<span class="n">is_blocked</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="n">file_manifest_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There was an error retrieving the manifest file at </span><span class="si">{</span><span class="n">DATA_URL</span><span class="si">}</span><span class="s1">manifest.json&#39;</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s2">&quot;cols&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;rows&quot;</span><span class="p">]]</span> <span class="c1"># zip columns and rows</span>

<span class="c1"># Convert to Pandas DataFrame and show stats table</span>
<span class="n">stats</span> <span class="o">=</span> <span class="n">get_file_stats</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FileType</th>
      <th>Count</th>
      <th>Size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>.gz</td>
      <td>394,950</td>
      <td>227.8GB</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="query-the-metadata-in-the-data-package">
<h2>Query the metadata in the data package<a class="headerlink" href="#query-the-metadata-in-the-data-package" title="Link to this heading">#</a></h2>
<p>Next we will download this data package’s <code class="docutils literal notranslate"><span class="pre">metadata.csv</span></code> file, print a summary of various values, and demonstrate filtering options.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">metadata.csv</span></code> file lists all of the US election political candidates websites that have been collected as part of the <a class="reference external" href="https://www.loc.gov/collections/united-states-elections-web-archive/">United States Elections Web Archive</a> and which are expected to be indexed in this data package’s CDX index files. To read more about this data package’s scope, see its <code class="docutils literal notranslate"><span class="pre">README</span></code>.</p>
<p>Because the CDX index files are a mixed bag of additional content, the <code class="docutils literal notranslate"><span class="pre">metadata.csv</span></code> file can be used to target content just from political candidate website domains.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metadata_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DATA_URL</span><span class="si">}</span><span class="s1">metadata.csv&#39;</span>
<span class="n">is_blocked</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="n">metadata_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">metadata_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loaded metadata file with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata_df</span><span class="p">)</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1"> entries.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loaded metadata file with 13,388 entries.
</pre></div>
</div>
</div>
</div>
<p>Next let’s convert to pandas DataFrame and print the available properties.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metadata_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>item_id, item_title, website_url, website_id, website_scopes, collection, website_elections, website_parties, website_places, website_districts, website_thumbnail, website_start_date, website_end_date, item_all_years, website_all_years, mods_url, access_condition
</pre></div>
</div>
</div>
</div>
<p>Let’s check the campaign years represented in <code class="docutils literal notranslate"><span class="pre">metadata.csv</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collections</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="n">collection</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">]</span>
<span class="n">years</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">years</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;2000&#39;, &#39;2002&#39;, &#39;2004&#39;, &#39;2006&#39;, &#39;2008&#39;, &#39;2010&#39;, &#39;2012&#39;, &#39;2014&#39;, &#39;2016&#39;]
</pre></div>
</div>
</div>
</div>
<section id="interpreting-the-metadata-fields">
<h3>Interpreting the metadata fields<a class="headerlink" href="#interpreting-the-metadata-fields" title="Link to this heading">#</a></h3>
<p>The fields are defined in this package’s <code class="docutils literal notranslate"><span class="pre">README</span></code>. Each row is a particular website collected for a specific candidate in a single election year.</p>
<p>Let’s look at an example row to understand how to interpret the fields. We’ll write out a paragraph describing our example row. We’ll look at row #<code class="docutils literal notranslate"><span class="pre">3460</span></code> (which we happen to know represents the only candidate in <code class="docutils literal notranslate"><span class="pre">metadata.csv</span></code> to have campaigned in two races in the same year under different parties):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">row_num</span> <span class="o">=</span> <span class="mi">3460</span> <span class="c1"># You can change this row number</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Here is how row #</span><span class="si">{</span><span class="n">row_num</span><span class="si">}</span><span class="s1"> appears in `metadata.csv`:&#39;</span><span class="p">)</span>                       
<span class="n">metadata_df</span><span class="p">[</span><span class="n">row_num</span><span class="p">:</span><span class="n">row_num</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Here is how row #3460 appears in `metadata.csv`:
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>item_id</th>
      <th>item_title</th>
      <th>website_url</th>
      <th>website_id</th>
      <th>website_scopes</th>
      <th>collection</th>
      <th>website_elections</th>
      <th>website_parties</th>
      <th>website_places</th>
      <th>website_districts</th>
      <th>website_thumbnail</th>
      <th>website_start_date</th>
      <th>website_end_date</th>
      <th>item_all_years</th>
      <th>website_all_years</th>
      <th>mods_url</th>
      <th>access_condition</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3460</th>
      <td>http://www.loc.gov/item/lcwaN0002501/</td>
      <td>Official Campaign Web Site - Cris Ericson</td>
      <td>http://www.usmjp.com/</td>
      <td>3415</td>
      <td>['http://crisericson.com', 'http://vermontnews...</td>
      <td>United States Elections, 2012</td>
      <td>['United States. Congress. Senate', 'Vermont. ...</td>
      <td>['U.S. Marijuana Party', 'Independent candidat...</td>
      <td>['Vermont', 'Vermont']</td>
      <td>[None, None]</td>
      <td>http://cdn.loc.gov/service/webcapture/project_...</td>
      <td>20121003</td>
      <td>20121019</td>
      <td>[2002, 2004, 2004, 2006, 2008, 2010, 2012, 201...</td>
      <td>[2012]</td>
      <td>https://tile.loc.gov/storage-services/service/...</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>First, let’s use the next cell to make sure that our dataframe columns with lists are interpretted correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_elections&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_elections&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_parties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_parties&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_places&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_places&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_districts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_districts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;item_all_years&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;item_all_years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_all_years&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_all_years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
<span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_scopes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_scopes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the next cell, we’ll grab all the info we need, then plug that info into a statement that describes our CSV row of data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">row</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_num</span><span class="p">]</span>
<span class="n">item_title</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;item_title&#39;</span><span class="p">]</span>
<span class="n">website_url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;website_url&#39;</span><span class="p">]</span>
<span class="n">collection</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span>
<span class="n">candidate_name</span> <span class="o">=</span> <span class="n">item_title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">year</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">campaign_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;website_elections&#39;</span><span class="p">])</span>
<span class="n">website_elections</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;website_elections&#39;</span><span class="p">]</span>
<span class="n">website_parties</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;website_parties&#39;</span><span class="p">]</span>
<span class="n">website_places</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;website_places&#39;</span><span class="p">]</span>
<span class="n">website_districts</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;website_districts&#39;</span><span class="p">]</span>
<span class="n">website_all_years</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;website_all_years&#39;</span><span class="p">]</span>
<span class="n">website_all_years</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">item_all_years</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;item_all_years&#39;</span><span class="p">]</span>
<span class="n">item_all_years</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">item_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;item_id&#39;</span><span class="p">]</span>
<span class="n">mods_url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;mods_url&#39;</span><span class="p">]</span>

<span class="c1"># Now we&#39;ll plug those variables into our sentences.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Record #</span><span class="si">{</span><span class="n">row_num</span><span class="si">}</span><span class="s1"> in the metadata.csv is: </span><span class="si">{</span><span class="n">website_url</span><span class="si">}</span><span class="s1">, from the collection &quot;</span><span class="si">{</span><span class="n">collection</span><span class="si">}</span><span class="s1">&quot;.&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;This row represents the website in </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">, used for campaign(s) of the candidate: </span><span class="si">{</span><span class="n">candidate_name</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;In </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">, this candidate used this website in </span><span class="si">{</span><span class="n">campaign_count</span><span class="si">}</span><span class="s1"> campaign(s):&#39;</span><span class="p">)</span>
<span class="n">i</span><span class="o">=</span><span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">campaign_count</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">website_districts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">house_district</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  
    <span class="k">else</span><span class="p">:</span>
        <span class="n">house_district</span> <span class="o">=</span> <span class="n">website_districts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">. </span><span class="si">{</span><span class="n">website_elections</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">website_parties</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">website_places</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> | </span><span class="si">{</span><span class="n">house_district</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">website_all_years</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>   
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;This website (</span><span class="si">{</span><span class="n">website_url</span><span class="si">}</span><span class="s1">) was also used for these other campaign year(s) for </span><span class="si">{</span><span class="n">candidate_name</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">website_all_years</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">year</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;In total, this and possibly other websites were collected for this candidate in the following year(s): </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">item_all_years</span><span class="p">))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The loc.gov item record for </span><span class="si">{</span><span class="n">candidate_name</span><span class="si">}</span><span class="s1"> campaign sites can be viewed at </span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s1">, and its MODS record can be viewed at </span><span class="si">{</span><span class="n">mods_url</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>

<span class="c1"># The next line displays our dataframe as a table. Let&#39;s set it to show up to 300 characters in each cell</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_colwidth</span> <span class="o">=</span> <span class="mi">300</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Record #3460 in the metadata.csv is: http://www.usmjp.com/, from the collection &quot;United States Elections, 2012&quot;.
This row represents the website in 2012, used for campaign(s) of the candidate: Cris Ericson.
In 2012, this candidate used this website in 2 campaign(s):
  0. United States. Congress. Senate | U.S. Marijuana Party | Vermont | 
  1. Vermont. Governor | Independent candidates | Vermont | 
In total, this and possibly other websites were collected for this candidate in the following year(s): [2018, 2002, 2004, 2006, 2008, 2010, 2012]
The loc.gov item record for Cris Ericson campaign sites can be viewed at http://www.loc.gov/item/lcwaN0002501/, and its MODS record can be viewed at https://tile.loc.gov/storage-services/service/webcapture/project_1/mods/united-states-elections-web-archive/lcwaN0002501.xml.
</pre></div>
</div>
</div>
</div>
<p>Now let’s create a function that allows us to get summary information about any election, like the election for Vermont Governor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">election_summary</span><span class="p">(</span><span class="n">election_type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Input an election title. Output is a summary of CSV rows from that election. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">websites_by_year</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;website_elections&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">elections</span><span class="p">:</span> <span class="nb">any</span><span class="p">([</span><span class="n">election</span> <span class="o">==</span> <span class="n">election_type</span> <span class="k">for</span> <span class="n">election</span> <span class="ow">in</span> <span class="n">elections</span><span class="p">]))]</span>
    <span class="n">candidates</span> <span class="o">=</span> <span class="n">websites_by_year</span><span class="p">[</span><span class="s1">&#39;item_title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">websites</span> <span class="o">=</span> <span class="n">websites_by_year</span><span class="p">[</span><span class="s1">&#39;website_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="n">collection</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">websites_by_year</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>
    <span class="n">min_year</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">years</span><span class="p">)</span> <span class="k">if</span> <span class="n">years</span> <span class="k">else</span> <span class="s1">&#39;n/a&#39;</span>
    <span class="n">max_year</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">years</span><span class="p">)</span> <span class="k">if</span> <span class="n">years</span> <span class="k">else</span> <span class="s1">&#39;n/a&#39;</span>
    <span class="n">multi_year_websites</span> <span class="o">=</span> <span class="n">websites_by_year</span><span class="p">[</span><span class="n">websites_by_year</span><span class="p">[</span><span class="s1">&#39;website_all_years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;website_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Found in metadata.csv: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">websites</span><span class="p">)</span><span class="si">}</span><span class="s1"> unique campaign websites for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span><span class="si">}</span><span class="s1"> &quot;</span><span class="si">{</span><span class="n">election_type</span><span class="si">}</span><span class="s1">&quot; candidates, ranging from years </span><span class="si">{</span><span class="n">min_year</span><span class="si">}</span><span class="s1"> - </span><span class="si">{</span><span class="n">max_year</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">multi_year_websites</span><span class="p">)</span><span class="si">}</span><span class="s1"> of these websites were used multiple years.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s try our function to get get as summary of Vermont gubernatorial candidates represented in this data package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">election_summary</span><span class="p">(</span><span class="s1">&#39;Vermont. Governor&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found in metadata.csv: 31 unique campaign websites for 22 &quot;Vermont. Governor&quot; candidates, ranging from years 2002 - 2016.
13 of these websites were used multiple years.
</pre></div>
</div>
</div>
</div>
<p>Off-year elections aren’t represented in this data package even though they are in the <a class="reference external" href="https://www.loc.gov/collections/united-states-elections-web-archive/">United States Elections Web Archive</a> online collection. This is due to the way that content is organized in CDX files.</p>
<p>For example, Virginia’s gubernatorial elections are off-year elections (in odd-numbered years), and thus are not represented in this data package <a class="reference external" href="https://www.loc.gov/collections/united-states-elections-web-archive/?fa=subject:governor%7Csubject:virginia">even though they are in the online collection</a>.</p>
<p>After you run the next cell, try replacing “Virginia. Governor” with something like “United States. Congress. Senate”, “United States. President”, or “Michigan. Governor”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">election_summary</span><span class="p">(</span><span class="s1">&#39;Virginia. Governor&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Found in metadata.csv: 0 unique campaign websites for 0 &quot;Virginia. Governor&quot; candidates, ranging from years n/a - n/a.
0 of these websites were used multiple years.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="filter-and-download-cdx-index-files-analyze-text">
<h2>Filter and Download CDX index files, analyze text<a class="headerlink" href="#filter-and-download-cdx-index-files-analyze-text" title="Link to this heading">#</a></h2>
<p>The bulk of this dataset are CDX files. In this section, we’ll retrieve a small sample of those CDX files and analyze the text inside them.</p>
<p>Here we will define the functions in the order that they are used in this section of the notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">bs4</span><span class="w"> </span><span class="kn">import</span> <span class="n">BeautifulSoup</span> <span class="c1"># Used to process the scraped content</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gzip</span> <span class="c1"># Used to decompress the gzipped CDX files</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.feature_extraction.text</span><span class="w"> </span><span class="kn">import</span> <span class="n">CountVectorizer</span> <span class="c1"># Used to create a matrix out of a bag of words</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">time</span><span class="w"> </span><span class="kn">import</span> <span class="n">sleep</span> <span class="c1"># Used to provide a slight pause between requests</span>


<span class="n">WAYBACK_BASE_URL</span> <span class="o">=</span> <span class="s1">&#39;https://webarchive.loc.gov/all/&#39;</span>
<span class="n">WAYBACK_LEGACY_BASE_URL</span> <span class="o">=</span> <span class="s1">&#39;https://webarchive.loc.gov/legacy/&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">gather_files_from_manifest</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that takes a year (YYYY) as an argument.</span>
<span class="sd">    The function collects the locations of the CDX files </span>
<span class="sd">    listed by the provided year&#39;s manifest.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        year (str): String of a year YYYY.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :obj:`list` of :obj:`str` of individual CDX file URLs. In case</span>
<span class="sd">        of error, returns an empty list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">election_years</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;2000&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2002&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2004&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2006&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2008&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2010&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2012&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2014&quot;</span><span class="p">,</span>
        <span class="s2">&quot;2016&quot;</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">year</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">election_years</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">manifest_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">DATA_URL</span><span class="si">}</span><span class="s2">by-year/</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">/manifest.html&quot;</span>
            <span class="n">is_blocked</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="n">manifest_url</span><span class="p">)</span>
            <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
            <span class="n">cdx_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">cdx_files</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There was an error retrieving and/or parsing </span><span class="si">{</span><span class="n">manifest_url</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">fetch_file</span><span class="p">(</span><span class="n">cdx_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that takes a `String` as an argument.</span>
<span class="sd">    The `cdx_url` is a singular item from the result</span>
<span class="sd">    of the `gather_files_from_manifest` function.</span>
<span class="sd">    The function fetches the gzipped CDX file, decompresses it,</span>
<span class="sd">    splits it on the newlines, and removes the header. </span>
<span class="sd">    Args:</span>
<span class="sd">        cdx_url (str): Individual item from the result of</span>
<span class="sd">        the `gather_files_from_manifest` function.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :obj:`list` of :obj:`str` of individual CDX lines, each representing</span>
<span class="sd">        a web object. Returns an empty list in case of errors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the CDX file. For a production script, you&#39;ll want to build in additional error handling. </span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cdx_url</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1"># Here we decompress the gzipped CDX, decode it, split it on the newline, and remove the header</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cdx_content</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">cdx_content</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There was an error parsing the decompressing  CDX file: </span><span class="si">{</span><span class="n">cdx_url</span><span class="si">}</span><span class="s1">. This file will be skipped.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_dataframe</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that takes a :obj:`list` of :obj:`str` as an argument.</span>
<span class="sd">    `data` is the contents of the CDX file split on newlines. </span>
<span class="sd">    This function takes `data`, applies a schema to it, and transforms it</span>
<span class="sd">    into a `pandas.DataFrame`.</span>
<span class="sd">    Args:</span>
<span class="sd">        data (list): :obj:`list` of :obj:`str`. Each item is a line from</span>
<span class="sd">        a CDX file or group of files.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A `pandas.DataFrame` of a CDX file or group of files. In case of error,</span>
<span class="sd">        a blank pandas.DataFrame is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">schema</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;urlkey&#39;</span><span class="p">,</span>
        <span class="s1">&#39;timestamp&#39;</span><span class="p">,</span>
        <span class="s1">&#39;original&#39;</span><span class="p">,</span>
        <span class="s1">&#39;mimetype&#39;</span><span class="p">,</span>
        <span class="s1">&#39;statuscode&#39;</span><span class="p">,</span>
        <span class="s1">&#39;digest&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redirect&#39;</span><span class="p">,</span>
        <span class="s1">&#39;metatags&#39;</span><span class="p">,</span>
        <span class="s1">&#39;file_size&#39;</span><span class="p">,</span>
        <span class="s1">&#39;offset&#39;</span><span class="p">,</span>
        <span class="s1">&#39;warc_filename&#39;</span>
    <span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;There was an error converting the data into a dataframe. Returning</span><span class="se">\</span>
<span class="s1">              a blank dataframe.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_dataframe_from_manifest</span><span class="p">(</span><span class="n">manifest</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that takes a :obj:`list` of :obj:`str` as an argument.</span>
<span class="sd">    The `manifest` is a list of all the individual CDX files found</span>
<span class="sd">    from an Election year&#39;s or group of Election years&#39; HTML manifest.</span>
<span class="sd">    This function loops through each file, transforms it into a `pandas.DataFrame`</span>
<span class="sd">    by calling the `create_dataframe` function, concats the DataFrames together,</span>
<span class="sd">    and then returns the Dataframe representing the entire manifest.</span>
<span class="sd">    Args:</span>
<span class="sd">        manifest (list): :obj:`list` of :obj:`str` of all the individual CDX files found</span>
<span class="sd">    from an Election year&#39;s or group of Election years&#39; HTML manifest.</span>

<span class="sd">    Returns:</span>
<span class="sd">        `pandas.DataFrame` representing every file present in the `manifest`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span> 
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">cdx_url</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">manifest</span><span class="p">):</span>
        <span class="n">cdx</span> <span class="o">=</span> <span class="n">fetch_file</span><span class="p">(</span><span class="n">cdx_url</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cdx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_rows</span> <span class="o">=</span> <span class="n">create_dataframe</span><span class="p">(</span><span class="n">cdx</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">new_rows</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There was an error converting </span><span class="si">{</span><span class="n">cdx_url</span><span class="si">}</span><span class="s1"> to a dataframe. This may be</span><span class="se">\</span>
<span class="s1">                  due to a malformed CDX file. This data will be skipped.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fetch_text</span><span class="p">(</span><span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that takes a `pandas.Series`, which is a single row </span>
<span class="sd">    from a `pandas.DataFrame`, as an argument.</span>
<span class="sd">    The functions uses the timestamp and original fields from the `row`</span>
<span class="sd">    to request the specific resource from  OpenWayback. Once the resource is </span>
<span class="sd">    fetched, the Wayback banner div elements are removed so as to not detract </span>
<span class="sd">    from the words in the resource itself. </span>
<span class="sd">    Args:</span>
<span class="sd">        row (pandas.Series): `pandas.Series`, which is a single row </span>
<span class="sd">    from a `pandas.DataFrame`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        `String` of the resource&#39;s text. If an error is encountered, returns </span>
<span class="sd">        an empty string.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">playback_url</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;original&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;CDX row is missing timestamp. Not retrieving text for </span><span class="si">{</span><span class="n">playback_url</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">timestamp</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;2000&#39;</span><span class="p">):</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">WAYBACK_LEGACY_BASE_URL</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="n">WAYBACK_BASE_URL</span>
    <span class="n">is_blocked</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">make_request</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base_url</span><span class="si">}{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">playback_url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">pause</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error retrieving </span><span class="si">{</span><span class="n">base_url</span><span class="si">}{</span><span class="n">timestamp</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">playback_url</span><span class="si">}</span><span class="s1">. Skipping full text for this document.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">is_blocked</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;429 too many requests. Skipping: </span><span class="si">{</span><span class="n">base_url</span><span class="si">}{</span><span class="n">timestamp</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">playback_url</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">429</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
        <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;wm-maximized&#39;</span><span class="p">})]</span>
        <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">extract</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;wm-minimized&#39;</span><span class="p">})]</span>
        <span class="k">return</span> <span class="n">soup</span><span class="o">.</span><span class="n">text</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error parsing full text from </span><span class="si">{</span><span class="n">base_url</span><span class="si">}{</span><span class="n">timestamp</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">playback_url</span><span class="si">}</span><span class="s1">. Skipping full text for this document.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fetch_all_text</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function that takes a `pandas.Dataframe` as an argument.</span>
<span class="sd">    This is the most complicated function here. The function first cleans the</span>
<span class="sd">    `df` that was passed in by dropping all the rows that do not have a value in the</span>
<span class="sd">    mimetype field. Then, it drops all the duplicate digests, which removes resources</span>
<span class="sd">    that are exactly the same. Finally, it only returns rows that have &#39;text&#39; in the </span>
<span class="sd">    mimetype field and have a &#39;200&#39; or &#39;-&#39; HTTP status response.</span>
<span class="sd">    Once the `df` is cleaned, each resource&#39;s text is fetched from the Wayback,</span>
<span class="sd">    transformed into a matrix using `sklearn.CountVectorizer`, and then returns a `pandas.DataFrame`</span>
<span class="sd">    with words and their occurance per resource. A politeness of 15 seconds is added between Wayback requests.</span>
<span class="sd">    Args:</span>
<span class="sd">        row (pandas.DataFrame): `pandas.Dataframe` representing web resources as CDX lines.</span>

<span class="sd">    Returns:</span>
<span class="sd">        `pandas.Dataframe` of the resource&#39;s words tabulated per web resource.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">countvec</span> <span class="o">=</span> <span class="n">CountVectorizer</span><span class="p">(</span><span class="n">ngram_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">stop_words</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
    <span class="n">unprocessed_bag_of_words</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">text_df</span> <span class="o">=</span> <span class="n">df</span>\
        <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mimetype&#39;</span><span class="p">])</span>\
        <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;digest&#39;</span><span class="p">])</span>\
        <span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="p">(</span><span class="s1">&#39;statuscode.str.match(&quot;200&quot;) or statuscode.str.match(&quot;-&quot;)&#39;</span><span class="p">)</span> <span class="ow">and</span> 
                <span class="p">(</span><span class="s1">&#39;mimetype.str.contains(&quot;text&quot;)&#39;</span><span class="p">)</span>   
            <span class="p">),</span> 
            <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;python&#39;</span>
        <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">text_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">fetched_text</span> <span class="o">=</span> <span class="n">fetch_text</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fetched_text</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Haulting requests for web archives. Received a 429 error from the server, which means too many requests too quickly.&#39;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">unprocessed_bag_of_words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fetched_text</span><span class="p">)</span>
        
    
    <span class="n">processed_bag_of_words</span> <span class="o">=</span> <span class="n">countvec</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">unprocessed_bag_of_words</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">processed_bag_of_words</span><span class="o">.</span><span class="n">toarray</span><span class="p">(),</span><span class="n">columns</span><span class="o">=</span><span class="n">countvec</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<section id="gathering-the-list-of-cdx-files">
<h3>Gathering the list of CDX Files<a class="headerlink" href="#gathering-the-list-of-cdx-files" title="Link to this heading">#</a></h3>
<p>The first step is gathering the list of CDX files. To do that, simply call the <code class="docutils literal notranslate"><span class="pre">gather_files_from_manifest</span></code> function, providing the Election year as an argument.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">el00_files</span> <span class="o">=</span> <span class="n">gather_files_from_manifest</span><span class="p">(</span><span class="s1">&#39;2000&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s look at our first five files:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">el00_files</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;https://data.labs.loc.gov/us-elections/by-year/2000/cdx/unique.20010415093936.surt.cdx.gz&#39;,
 &#39;https://data.labs.loc.gov/us-elections/by-year/2000/cdx/unique.20010415094743.surt.cdx.gz&#39;,
 &#39;https://data.labs.loc.gov/us-elections/by-year/2000/cdx/unique.20010415095044.surt.cdx.gz&#39;,
 &#39;https://data.labs.loc.gov/us-elections/by-year/2000/cdx/unique.20010415095244.surt.cdx.gz&#39;,
 &#39;https://data.labs.loc.gov/us-elections/by-year/2000/cdx/unique.20010415095459.surt.cdx.gz&#39;]
</pre></div>
</div>
</div>
</div>
</section>
<section id="inspect-a-sample-cdx-file">
<h3>Inspect a sample CDX File<a class="headerlink" href="#inspect-a-sample-cdx-file" title="Link to this heading">#</a></h3>
<p>Next, we’ll demonstrate what a particular CDX File looks like. We’ll look at the first five lines of our first CDX from 2000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cdx</span> <span class="o">=</span> <span class="n">fetch_file</span><span class="p">(</span><span class="n">el00_files</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cdx</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;com,voter)/home/candidates/info/0,1214,2-11880-,00.html 20001002182124 http://www.voter.com:80/home/candidates/info/0,1214,2-11880-,00.html text/html 200 FYXP43MQC5GVBQMVK3ETWSPXUBR5ICKP - - 5051 149 unique.20010415093936.arc.gz&#39;,
 &#39;com,voter)/home/candidates/info/0,1214,2-18885-,00.html 20001002185814 http://www.voter.com:80/home/candidates/info/0,1214,2-18885-,00.html text/html 200 H6QN5ZULJ6YZP756QNVM3YXKXC7HZUIL - - 4829 5200 unique.20010415093936.arc.gz&#39;,
 &#39;com,voter)/home/candidates/info/0,1214,2-18880-,00.html 20001002185815 http://www.voter.com:80/home/candidates/info/0,1214,2-18880-,00.html text/html 200 HFG67JI4KBPHFXMQE5DJRHF3OEKKBOO6 - - 4794 10029 unique.20010415093936.arc.gz&#39;,
 &#39;com,voter)/home/officials/general/1,1195,2-2467-,00.html 20001002185815 http://voter.com:80/home/officials/general/1,1195,2-2467-,00.html text/html 200 HZJFLTHZD5MGEPJS2WVGBHQRQUPFBE3O - - 5282 14823 unique.20010415093936.arc.gz&#39;,
 &#39;com,voter)/home/candidates/info/0,1214,2-18886-,00.html 20001002185816 http://www.voter.com:80/home/candidates/info/0,1214,2-18886-,00.html text/html 200 QAM7JW7S4CNYMP6HLA6DASOXTO2SIGWO - - 4823 20105 unique.20010415093936.arc.gz&#39;]
</pre></div>
</div>
</div>
</div>
<p>Now, here is the same CDX transformed into a DataFrame</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cdx_df</span> <span class="o">=</span> <span class="n">create_dataframe</span><span class="p">(</span><span class="n">cdx</span><span class="p">)</span>
<span class="n">cdx_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>urlkey</th>
      <th>timestamp</th>
      <th>original</th>
      <th>mimetype</th>
      <th>statuscode</th>
      <th>digest</th>
      <th>redirect</th>
      <th>metatags</th>
      <th>file_size</th>
      <th>offset</th>
      <th>warc_filename</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>com,voter)/home/candidates/info/0,1214,2-11880-,00.html</td>
      <td>20001002182124</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-11880-,00.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>FYXP43MQC5GVBQMVK3ETWSPXUBR5ICKP</td>
      <td>-</td>
      <td>-</td>
      <td>5051</td>
      <td>149</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>1</th>
      <td>com,voter)/home/candidates/info/0,1214,2-18885-,00.html</td>
      <td>20001002185814</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-18885-,00.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>H6QN5ZULJ6YZP756QNVM3YXKXC7HZUIL</td>
      <td>-</td>
      <td>-</td>
      <td>4829</td>
      <td>5200</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>2</th>
      <td>com,voter)/home/candidates/info/0,1214,2-18880-,00.html</td>
      <td>20001002185815</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-18880-,00.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>HFG67JI4KBPHFXMQE5DJRHF3OEKKBOO6</td>
      <td>-</td>
      <td>-</td>
      <td>4794</td>
      <td>10029</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>3</th>
      <td>com,voter)/home/officials/general/1,1195,2-2467-,00.html</td>
      <td>20001002185815</td>
      <td>http://voter.com:80/home/officials/general/1,1195,2-2467-,00.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>HZJFLTHZD5MGEPJS2WVGBHQRQUPFBE3O</td>
      <td>-</td>
      <td>-</td>
      <td>5282</td>
      <td>14823</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>4</th>
      <td>com,voter)/home/candidates/info/0,1214,2-18886-,00.html</td>
      <td>20001002185816</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-18886-,00.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>QAM7JW7S4CNYMP6HLA6DASOXTO2SIGWO</td>
      <td>-</td>
      <td>-</td>
      <td>4823</td>
      <td>20105</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1096875</th>
      <td>com,voter)/home/candidates/info/0,1214,2-9118-,00.html</td>
      <td>20001002183052</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-9118-,00.html</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>118</td>
      <td>145323588</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>1096876</th>
      <td>com,voter)/home/candidates/info/0,1214,2-9115-,00.html</td>
      <td>20001002183052</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-9115-,00.html</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>118</td>
      <td>145323706</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>1096877</th>
      <td>com,voter)/home/candidates/info/0,1214,2-15361-,00.html</td>
      <td>20001002182249</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-15361-,00.html</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>119</td>
      <td>145323824</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>1096878</th>
      <td>com,voter)/home/candidates/info/0,1214,2-12994-,00.html</td>
      <td>20001002181842</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-12994-,00.html</td>
      <td>text/html</td>
      <td>404</td>
      <td>UDSH36NBYWO2X73LNMX2LEHLNQ7FYXHZ</td>
      <td>-</td>
      <td>-</td>
      <td>351</td>
      <td>145323943</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>1096879</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>1096880 rows × 11 columns</p>
</div></div></div>
</div>
</section>
<section id="election-2000-dataframe">
<h3>Election 2000 DataFrame<a class="headerlink" href="#election-2000-dataframe" title="Link to this heading">#</a></h3>
<p>Now we’ll create a DataFrame from the first fifteen CDX files in the 2000 election subset. To do that, we’ll use the <code class="docutils literal notranslate"><span class="pre">create_dataframe_from_manifest</span></code> which loops over the CDX files and calls <code class="docutils literal notranslate"><span class="pre">create_dataframe</span></code> programmatically instead of manually and individually as we did above.</p>
<p>If we had more time or were working on a more powerful computer, we’d pull from all of the files in the 2000 subset, but for now we’ll just pull from the first ten.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">el00_df</span> <span class="o">=</span> <span class="n">create_dataframe_from_manifest</span><span class="p">(</span><span class="n">el00_files</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">15</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">el00_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>urlkey</th>
      <th>timestamp</th>
      <th>original</th>
      <th>mimetype</th>
      <th>statuscode</th>
      <th>digest</th>
      <th>redirect</th>
      <th>metatags</th>
      <th>file_size</th>
      <th>offset</th>
      <th>warc_filename</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>com,voter)/home/candidates/info/0,1214,2-11880-,00.html</td>
      <td>20001002182124</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-11880-,00.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>FYXP43MQC5GVBQMVK3ETWSPXUBR5ICKP</td>
      <td>-</td>
      <td>-</td>
      <td>5051</td>
      <td>149</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>1</th>
      <td>com,voter)/home/candidates/info/0,1214,2-18885-,00.html</td>
      <td>20001002185814</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-18885-,00.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>H6QN5ZULJ6YZP756QNVM3YXKXC7HZUIL</td>
      <td>-</td>
      <td>-</td>
      <td>4829</td>
      <td>5200</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>2</th>
      <td>com,voter)/home/candidates/info/0,1214,2-18880-,00.html</td>
      <td>20001002185815</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-18880-,00.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>HFG67JI4KBPHFXMQE5DJRHF3OEKKBOO6</td>
      <td>-</td>
      <td>-</td>
      <td>4794</td>
      <td>10029</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>3</th>
      <td>com,voter)/home/officials/general/1,1195,2-2467-,00.html</td>
      <td>20001002185815</td>
      <td>http://voter.com:80/home/officials/general/1,1195,2-2467-,00.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>HZJFLTHZD5MGEPJS2WVGBHQRQUPFBE3O</td>
      <td>-</td>
      <td>-</td>
      <td>5282</td>
      <td>14823</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>4</th>
      <td>com,voter)/home/candidates/info/0,1214,2-18886-,00.html</td>
      <td>20001002185816</td>
      <td>http://www.voter.com:80/home/candidates/info/0,1214,2-18886-,00.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>QAM7JW7S4CNYMP6HLA6DASOXTO2SIGWO</td>
      <td>-</td>
      <td>-</td>
      <td>4823</td>
      <td>20105</td>
      <td>unique.20010415093936.arc.gz</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>338148</th>
      <td>org,ctgop)/county/tolland.htm</td>
      <td>20001006073643</td>
      <td>http://www.ctgop.org:80/county/tolland.htm</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>101</td>
      <td>79251104</td>
      <td>unique.20010415101811.arc.gz</td>
    </tr>
    <tr>
      <th>338149</th>
      <td>org,ctgop)/county/tolland.htm</td>
      <td>20001005073549</td>
      <td>http://www.ctgop.org:80/county/tolland.htm</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>101</td>
      <td>79251205</td>
      <td>unique.20010415101811.arc.gz</td>
    </tr>
    <tr>
      <th>338150</th>
      <td>org,ctgop)/county/tolland.htm</td>
      <td>20001004073505</td>
      <td>http://www.ctgop.org:80/county/tolland.htm</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>101</td>
      <td>79251306</td>
      <td>unique.20010415101811.arc.gz</td>
    </tr>
    <tr>
      <th>338151</th>
      <td>org,ctgop)/county/tolland.htm</td>
      <td>20001003073437</td>
      <td>http://www.ctgop.org:80/county/tolland.htm</td>
      <td>text/html</td>
      <td>200</td>
      <td>TIRWMHRDJ5L22TJWCXVA6TNU5YOB65SW</td>
      <td>-</td>
      <td>-</td>
      <td>1421</td>
      <td>79251407</td>
      <td>unique.20010415101811.arc.gz</td>
    </tr>
    <tr>
      <th>338152</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>1541579 rows × 11 columns</p>
</div></div></div>
</div>
</section>
<section id="mimetypes">
<h3>Mimetypes<a class="headerlink" href="#mimetypes" title="Link to this heading">#</a></h3>
<p>For this exercise, we’re going to take a brief look at the mimetypes. First, we’ll select all the mimetypes in the Dataframe and get their sums by calling <code class="docutils literal notranslate"><span class="pre">value_counts</span></code> which is a method from Pandas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">el00_mimetypes</span> <span class="o">=</span> <span class="n">el00_df</span><span class="p">[</span><span class="s1">&#39;mimetype&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">el00_mimetypes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mimetype
-                           1493256
text/html                     43969
image/jpeg                     2756
image/gif                      1311
application/pdf                 122
text/plain                       59
image/bmp                        28
audio/x-pn-realaudio             18
application/msword               11
text/css                          4
image/png                         4
application/octet-stream          3
application/x-javascript          3
video/quicktime                   3
application/zip                   2
audio/x-wav                       2
audio/midi                        2
text/xml                          2
application/mac-binhex40          1
audio/x-aiff                      1
image/tiff                        1
application/x-tar                 1
application/x-pointplus           1
audio/x-midi                      1
video/x-msvideo                   1
audio/basic                       1
audio/x-mpeg                      1
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="filtering-by-domain">
<h3>Filtering by domain<a class="headerlink" href="#filtering-by-domain" title="Link to this heading">#</a></h3>
<p>Let’s now look at the domains and subdomains represented in the 2000 CDX files. We’ll ignore the “www” part of URLs, but otherwise retain subdomains.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">re</span> <span class="c1"># For using regular expressions to remove parts of URLs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span> <span class="c1"># For locating the base domain in URLs</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_domains</span><span class="p">(</span><span class="n">urls</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">urls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">urls</span> <span class="o">=</span> <span class="p">[</span><span class="n">urls</span><span class="p">]</span>
    <span class="n">domains</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">urls</span><span class="p">:</span>
        <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">netloc</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span> <span class="o">==</span> <span class="nb">bytes</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Remove &quot;www.&quot; and ports if they exist</span>
        <span class="k">if</span> <span class="n">domain</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">domain</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Remove www., www1., etc.</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;www\d?\.(.*)&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;\1&quot;</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
            <span class="c1"># Remove ports, as in some-website.com:80</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">domains</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">domains</span><span class="p">)</span>

<span class="n">el00_df</span><span class="p">[</span><span class="s1">&#39;domains&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">el00_df</span><span class="p">[</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_domains</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">for</span> <span class="n">cdx_domain</span> <span class="ow">in</span> <span class="n">el00_df</span><span class="p">[</span><span class="s1">&#39;domains&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cdx_domain</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>voter.com
whitehouse.gov
hayes.voter.com
freespeech.org
cnn.com
freedomchannel.com
essential.org
fsudemocrats.org
commoncause.org
democrats.org
uspolitics.about.com
enterstageright.com
reason.com
usconservatives.about.com
idaho-democrats.org
usliberals.about.com
www10.nytimes.com
election.voter.com
graphics.nytimes.com
nydems.org
adams.voter.com
mockelection.com
rpk.org
dnet.org
commonconservative.com
beavoter.org
beavoter.com
iowademocrats.org
forums.about.com
thiselection.com
indiaelection.com
server1.dscc.org
search.algore2000.com
forums.nytimes.com
azlp.org
intellectualcapital.com
prospect.org
grassroots.com
rnc.org
lwv.org
mn-politics.com
newwestpolitics.com
popandpolitics.com
washingtonpost.com
nacdnet.org
lp.org
algore2000.com
crlp.org
harrybrowne2000.org
ga.lp.org
emilyslist.org
ncgop.org
arkdems.org
cbdnet.org
keyes-grassroots.com
faqvoter.com
americanprospect.org
partners.nytimes.com
indems.org
ageofreason.com
vanishingvoter.org
nyc.dnet.org
robots.cnn.com
informedvoter.com
virginiapolitics.com
newpolitics.com
nan
md.lp.org
ca-dem.org
beachdemocrats.org
ohiodems.org
maryland.reformparty.org
muscatinedemocrats.org
9thdistgagop.org
rcdnet.org
azgop.org
maricopagop.org
kansas.reformparty.org
newjersey.reformparty.org
california.reformparty.org
timeline.reformparty.org
algop.org
pelicanpolitics.com
espanol.voter.com
gorelieberman.com
election.com
ceednet.org
followthemoney.org
debates.org
cagop.org
wsrp.org
indgop.org
members.freespeech.org
schoolelection.com
convention.texasgop.org
cal.votenader.org
candidate.grassroots.com
1-877-leadnow.com
madison.voter.com
sierraclub.org
mt.nacdnet.org
ma.lwv.org
irchelp.org
calvoter.org
njdems.org
sfvoter.com
vademocrats.org
reformparty.org
missouridems.org
pa.lwv.org
akdemocrats.org
njlp.org
hagelin.org
keyes2000.org
tray.com
nrsc.org
deldems.org
nrcc.org
ksdp.org
kansasyoungdemocrats.org
washington.reformparty.org
dems2000.com
arkgop.com
scdp.org
plp.org
votenader.org
votenader.com
northcarolina.reformparty.org
ca.lwv.org
ks.nacdnet.org
txdemocrats.org
politics1.com
gagop.org
slp.org
gwbush.com
akrepublicans.org
wi.nacdnet.org
green.votenader.org
rpv.org
fec.gov
nytimes.com
naacp.org
hawaiidemocrats.org
nygop.org
gopatgo2000.org
democratsabroad.org
pub.whitehouse.gov
archive.lp.org
gop-mn.org
migop.org
ca.lp.org
monmouthlp.org
ncdp.org
cologop.org
mi.lp.org
cobbdemocrats.org
tx.lp.org
campaignoffice.com
freetrial.campaignoffice.com
calendar.rnc.org
rireformparty.org
ehdemocrats.org
poll1.debates.org
nevadagreenparty.org
newvoter.com
mi.lwv.org
georgia.reformparty.org
delaware.reformparty.org
stonewalldfl.org
santacruzlp.org
forums.hagelin.org
forum.hagelin.org
iowagop.org
ohiogop.org
sddemocrats.org
skdemocrats.org
wisdems.org
sfgreenparty.org
il.lp.org
rtumble.com
ctdems.org
alaskarepublicans.com
detroitnaacp.org
greenparty.org
ndgop.com
nh-democrats.org
rosecity.net
sandiegovoter.com
montanagop.org
dc.reformparty.org
greenparties.org
mainegop.com
stmarysdemocrats.org
comalcountydemocrats.org
masonforrnc.org
sblp.org
chesapeakedemocrats.org
tejanodemocrats.org
connecticut.georgewbush.com
students.georgewbush.com
youngprofessionals.georgewbush.com
maine.georgewbush.com
latinos.georgewbush.com
veterans.georgewbush.com
africanamericans.georgewbush.com
missouri.georgewbush.com
agriculture.georgewbush.com
mississippi.georgewbush.com
minnesota.georgewbush.com
arizona.georgewbush.com
northcarolina.georgewbush.com
virginia.georgewbush.com
kentucky.georgewbush.com
texas.georgewbush.com
lvvlwv.org
kansassenatedemocrats.org
nhgop.org
nebraskademocrats.org
southcarolina.reformparty.org
tndemocrats.org
fcncgop.org
padems.com
gore-2000.com
union.arkdems.org
illinois.reformparty.org
nevadagop.org
rhodeisland.reformparty.org
massdems.org
allencountydemocrats.org
mogop.org
oklahoma.reformparty.org
oklp.org
speakout.com
windemocrats.org
washingtoncountydemocrats.org
salinecodemocrats.org
njgop.org
sddp.org
pennsylvania.reformparty.org
lademo.org
allgore.com
web.democrats.org
pagop.org
library.whitehouse.gov
docs.whitehouse.gov
idaho.reformparty.org
alaska.net
georgybush.com
rpof.org
publishing1.speakout.com
de.lp.org
mainedems.org
clarkgop.com
kansashousedemocrats.org
georgiaparty.com
la.lp.org
ny.lp.org
nebraska.reformparty.org
maine.reformparty.org
indiana.reformparty.org
myweb.clark.net
clark.net
ga.lwv.org
traviscountydemocrats.org
cheshiredemocrats.org
exchange.nrcc.org
growthelp.org
sbdemocrats.org
montana.reformparty.org
politicalshop.com
massgop.com
ohio.reformparty.org
scgop.com
wvgop.org
c-span.org
westvirginia.reformparty.org
wwwalgore2000.com
texas.reformparty.org
florida-democrats.org
delawaregop.com
publicrelations.reformparty.org
nj.nacdnet.org
ohionlp.org
communications.reformparty.org
newhampshire.reformparty.org
aladems.org
arkansas.reformparty.org
avlp.org
vtdemocrats.org
jackgreenlp.org
waynegop.org
mi-democrats.com
13thdistrictdems.org
rules.reformparty.org
negop.org
dscc.org
mccain2000.com
oclp.org
ilgop.org
hawaii.reformparty.org
arch-cgi.lp.org
crnc.org
sc.ca.lp.org
8thcd.vademocrats.org
foreignpolicy2000.org
bradely.campaignoffice.com
wwwsanderson.campaignoffice.com
florida.reformparty.org
al.lp.org
dpo.org
oahudemocrats.org
columbia.arkdems.org
kentucky.reformparty.org
phoenixnewtimes.com
purepolitics.com
concernedvoter.com
iowa.reformparty.org
wyoming.reformparty.org
harriscountygreenparty.org
american-politics.com
issues.reformparty.org
nysrtlp.org
stpaul.mn.lwv.org
arlingtondemocrats.org
okgop.com
utahgop.org
utdemocrats.org
mississippi.reformparty.org
plymouth.ma.nacdnet.org
tennessee.reformparty.org
minnesota.reformparty.org
dpnm.org
georgebush2000.com
vayoungdemocrats.org
northdakota.reformparty.org
stonewalldemocrats.org
virginia.reformparty.org
fastlane.net
youngdemocrats.org
msgop.org
calgop.org
votegrassroots.com
wvdemocrats.com
housedems2000.com
lubbockdemocrats.org
ildems.org
okdemocrats.org
lccdnet.org
fecweb1.fec.gov
trinity.ca.lp.org
ventura.ca.lp.org
3rdcd.vademocrats.org
de.lwv.org
mdgop.org
flgopsenate.campaignoffice.com
bradley.campaignoffice.com
kydems.campaignoffice.com
tx.nacdnet.org
mo.nacdnet.org
texasgop.org
in.rcdnet.org
life.ca.lp.org
victory.texasgop.org
charlestondemocrats.org
wyomingdemocrats.com
nd.nacdnet.org
college.reformparty.org
al.nacdnet.org
nddemnpl.campaignoffice.com
kulick-jackson.campaignoffice.com
wasiluk.campaignoffice.com
hilstrom.campaignoffice.com
schumacher.campaignoffice.com
dfl.org
slawik.campaignoffice.com
markthompson.campaignoffice.com
rest.campaignoffice.com
vigil.campaignoffice.com
graves.campaignoffice.com
mcinnis.campaignoffice.com
hoosier.campaignoffice.com
connor.campaignoffice.com
bernardy.campaignoffice.com
housedflcaucus.campaignoffice.com
goodwin.campaignoffice.com
peaden.campaignoffice.com
kurita.campaignoffice.com
hi.lp.org
mtdemocrats.org
or.nacdnet.org
kcswcd.mo.nacdnet.org
id.nacdnet.org
sd.nacdnet.org
ny.nacdnet.org
yvote2000.com
oh.nacdnet.org
va.nacdnet.org
tn.nacdnet.org
fl.nacdnet.org
ca.nacdnet.org
co.nacdnet.org
ky.lp.org
georgewbush.com
massachusetts.reformparty.org
arizona.reformparty.org
louisiana.reformparty.org
nm.nacdnet.org
tazewell.va.nacdnet.org
aflcio.org
azdem.org
columbiana.oh.nacdnet.org
lacledeswcd.mo.nacdnet.org
reclaimdemocracy.org
ctgop.org
nevada.reformparty.org
in.nacdnet.org
michigan.reformparty.org
newyork.reformparty.org
nc.nacdnet.org
wa.nacdnet.org
ak.nacdnet.org
pa.nacdnet.org
billbradley.com
macdnet.org
lmcd.mt.nacdnet.org
socialdemocrats.org
bexardemocrats.org
alabama.reformparty.org
globalelection.com
wisconsin.reformparty.org
geocities.com
coloradodems.org
</pre></div>
</div>
</div>
</div>
<p>As you can see from the list above, the 2000 CDX files include content from a wide range of domains, not limited to political candidate campaign websites.</p>
<p>In the early years of the <a class="reference external" href="https://www.loc.gov/collections/united-states-elections-web-archive/">United States Elections Web Archive</a>, the scope of the collection included websites of political parties, government, advocacy groups, bloggers, and other individuals and groups expressing relevant views. These sites have generally been moved into the <a class="reference external" href="https://www.loc.gov/collections/public-policy-topics-web-archive/">Public Policy Topics Web Archive</a> or into the general web archives. However, the CDX files index the content as it was originally captured. The CDX files may also index content from non-candidate resources if candidate sites linked to those resources or embedded that content. Occassionally, other out of scope content may also appear in CDX files otherwise dedicated to U.S. elections.</p>
<p>Let’s grab only those lines from the CDX files that match domains from the candidate websites in our <code class="docutils literal notranslate"><span class="pre">metadata.csv</span></code> file. We’ll include the campaign candidates’ websites themselves, as well as any domains that appear in the <code class="docutils literal notranslate"><span class="pre">scope</span></code> column. Domains that appear in the <code class="docutils literal notranslate"><span class="pre">scope</span></code> column are additional URLs that the web archiving crawler was instructed to collect in addition to the campaign website, if the campaign website linked to those URLs. For a more refined description, see this data package’s <code class="docutils literal notranslate"><span class="pre">README</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_domains_by_year</span><span class="p">(</span><span class="n">year</span><span class="p">):</span>
    <span class="n">year_metadata</span> <span class="o">=</span> <span class="n">metadata_df</span><span class="p">[</span><span class="n">metadata_df</span><span class="p">[</span><span class="s1">&#39;collection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">year</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">year_metadata</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">year_metadata</span><span class="p">[</span><span class="s1">&#39;seeds_domains&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_metadata</span><span class="p">[</span><span class="s1">&#39;website_url&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_domains</span><span class="p">)</span>
        <span class="n">year_metadata</span><span class="p">[</span><span class="s1">&#39;scope_domains&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_metadata</span><span class="p">[</span><span class="s1">&#39;website_scopes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_domains</span><span class="p">)</span>
        <span class="n">year_metadata</span><span class="p">[</span><span class="s1">&#39;all_domains&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year_metadata</span><span class="p">[</span><span class="s1">&#39;seeds_domains&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">year_metadata</span><span class="p">[</span><span class="s1">&#39;scope_domains&#39;</span><span class="p">]</span>
        <span class="n">all_domains</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">year_metadata</span><span class="p">[</span><span class="s1">&#39;all_domains&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_domains</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sorry, there were no rows in metadata.csv for content from </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">metadata_domains</span> <span class="o">=</span> <span class="n">get_domains_by_year</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Domains from the </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="si">}</span><span class="s1"> US Elections collection:&#39;</span><span class="p">)</span>
<span class="n">metadata_domains</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Domains from the 2000 US Elections collection:
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;gopatgo2000.org&#39;,
 &#39;keyes2000.org&#39;,
 &#39;forum.hagelin.org&#39;,
 &#39;hagelin.org&#39;,
 &#39;algore2000.com&#39;,
 &#39;algore.com&#39;,
 &#39;harrybrowne2000.org&#39;]
</pre></div>
</div>
</div>
</div>
<p>Now we’re ready to filter. Let’s filter down our sample CDX lines to just those lines that point to the candidate website domains from metadata.csv, listed above. This means we’ll only include CDX rows for domains like <code class="docutils literal notranslate"><span class="pre">algore2000.org</span></code>, <code class="docutils literal notranslate"><span class="pre">gopatgo2000.org</span></code>, but not sites like <code class="docutils literal notranslate"><span class="pre">vote.com</span></code> or <code class="docutils literal notranslate"><span class="pre">whitehouse.gov</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cdx_candidate_domains_el00</span> <span class="o">=</span> <span class="n">el00_df</span><span class="p">[</span>
    <span class="n">el00_df</span><span class="p">[</span><span class="s1">&#39;original&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">url</span><span class="p">:</span> 
            <span class="nb">any</span><span class="p">(</span><span class="n">domain</span> <span class="ow">in</span> <span class="n">url</span> <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">metadata_domains</span><span class="p">)</span> <span class="k">if</span> <span class="n">url</span> 
            <span class="k">else</span> <span class="kc">False</span>
    <span class="p">)</span>
<span class="p">]</span>
<span class="n">cdx_candidate_domains_el00</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>urlkey</th>
      <th>timestamp</th>
      <th>original</th>
      <th>mimetype</th>
      <th>statuscode</th>
      <th>digest</th>
      <th>redirect</th>
      <th>metatags</th>
      <th>file_size</th>
      <th>offset</th>
      <th>warc_filename</th>
      <th>domains</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25175</th>
      <td>com,algore2000,search)/search</td>
      <td>20001030063531</td>
      <td>http://search.algore2000.com:80/search/</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>97</td>
      <td>7471624</td>
      <td>unique.20010415093936.arc.gz</td>
      <td>search.algore2000.com</td>
    </tr>
    <tr>
      <th>26166</th>
      <td>com,algore2000,search)/search</td>
      <td>20001030053022</td>
      <td>http://search.algore2000.com:80/search/</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>97</td>
      <td>7587973</td>
      <td>unique.20010415093936.arc.gz</td>
      <td>search.algore2000.com</td>
    </tr>
    <tr>
      <th>49892</th>
      <td>com,algore2000,search)/search</td>
      <td>20001029053020</td>
      <td>http://search.algore2000.com:80/search/</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>97</td>
      <td>10612154</td>
      <td>unique.20010415093936.arc.gz</td>
      <td>search.algore2000.com</td>
    </tr>
    <tr>
      <th>73526</th>
      <td>com,algore2000,search)/search</td>
      <td>20001028053001</td>
      <td>http://search.algore2000.com:80/search/</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>99</td>
      <td>13619683</td>
      <td>unique.20010415093936.arc.gz</td>
      <td>search.algore2000.com</td>
    </tr>
    <tr>
      <th>97191</th>
      <td>com,algore2000,search)/search</td>
      <td>20001027053201</td>
      <td>http://search.algore2000.com:80/search/</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>98</td>
      <td>16632272</td>
      <td>unique.20010415093936.arc.gz</td>
      <td>search.algore2000.com</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>336264</th>
      <td>org,keyes2000)/images/newsimage.jpg</td>
      <td>20001003073434</td>
      <td>http://keyes2000.org:80/images/newsimage.jpg</td>
      <td>image/jpeg</td>
      <td>200</td>
      <td>LWERVVNORJQ6IBZCJ4SBNH26JU6NH3MV</td>
      <td>-</td>
      <td>-</td>
      <td>13527</td>
      <td>76178594</td>
      <td>unique.20010415101811.arc.gz</td>
      <td>keyes2000.org</td>
    </tr>
    <tr>
      <th>336611</th>
      <td>com,algore2000)/briefingroom/releases/pr_091300_gore_wins_4.html</td>
      <td>20001004075816</td>
      <td>http://www.algore2000.com:80/briefingroom/releases/pr_091300_Gore_Wins_4.html</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>130</td>
      <td>76906140</td>
      <td>unique.20010415101811.arc.gz</td>
      <td>algore2000.com</td>
    </tr>
    <tr>
      <th>336612</th>
      <td>com,algore2000)/briefingroom/releases/pr_091300_gore_wins_4.html</td>
      <td>20001004073516</td>
      <td>http://algore2000.com:80/briefingroom/releases/pr_091300_Gore_Wins_4.html</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>127</td>
      <td>76906270</td>
      <td>unique.20010415101811.arc.gz</td>
      <td>algore2000.com</td>
    </tr>
    <tr>
      <th>336613</th>
      <td>com,algore2000)/briefingroom/releases/pr_091300_gore_wins_4.html</td>
      <td>20001003075840</td>
      <td>http://www.algore2000.com:80/briefingroom/releases/pr_091300_Gore_Wins_4.html</td>
      <td>-</td>
      <td>-</td>
      <td>3I42H3S6NNFQ2MSVX7XZKYAYSCX5QBYJ</td>
      <td>-</td>
      <td>-</td>
      <td>130</td>
      <td>76906397</td>
      <td>unique.20010415101811.arc.gz</td>
      <td>algore2000.com</td>
    </tr>
    <tr>
      <th>336614</th>
      <td>com,algore2000)/briefingroom/releases/pr_091300_gore_wins_4.html</td>
      <td>20001003073434</td>
      <td>http://algore2000.com:80/briefingroom/releases/pr_091300_Gore_Wins_4.html</td>
      <td>text/html</td>
      <td>200</td>
      <td>6Y6BX6SUDNF5CASBJH2LASINQ46ASMQF</td>
      <td>-</td>
      <td>-</td>
      <td>9606</td>
      <td>76906527</td>
      <td>unique.20010415101811.arc.gz</td>
      <td>algore2000.com</td>
    </tr>
  </tbody>
</table>
<p>6448 rows × 12 columns</p>
</div></div></div>
</div>
</section>
<section id="fetching-the-text">
<h3>Fetching the Text<a class="headerlink" href="#fetching-the-text" title="Link to this heading">#</a></h3>
<p>Now that we know the majority of the remaining resources in this dataset have a text-based mimetype, we can gather all the text and do some basic analysis. First, we’ll fetch all the text from just 50 rows. This will take a few minutes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text_df</span> <span class="o">=</span> <span class="n">fetch_all_text</span><span class="p">(</span><span class="n">cdx_candidate_domains_el00</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="top-25-words">
<h3>Top 25 Words<a class="headerlink" href="#top-25-words" title="Link to this heading">#</a></h3>
<p>Now that the text has been fetched, we’ll do a simple summation and sorting, displaying the top 25 words from the first 50 rows of the 2000 Election dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">text_df</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>tax              34
bush             34
cut              18
plan             16
republicans      11
new              11
gop               9
republican        7
budget            7
vote              7
00                7
gore              7
senate            6
committee         6
year              6
george            6
news              5
americans         5
2000              5
congressional     5
york              5
dakota            4
carolina          4
virginia          4
debt              4
dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Data Packages"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="sanborn.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">LoC Data Package Tutorial: Sanborn Maps collection</p>
      </div>
    </a>
    <a class="right-next"
       href="free-to-use.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">LoC Data Package Tutorial: Free to Use collection</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#output-data-package-summary">Output data package summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#query-the-metadata-in-the-data-package">Query the metadata in the data package</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-the-metadata-fields">Interpreting the metadata fields</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-and-download-cdx-index-files-analyze-text">Filter and Download CDX index files, analyze text</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gathering-the-list-of-cdx-files">Gathering the list of CDX Files</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-a-sample-cdx-file">Inspect a sample CDX File</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#election-2000-dataframe">Election 2000 DataFrame</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mimetypes">Mimetypes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-by-domain">Filtering by domain</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fetching-the-text">Fetching the Text</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#top-25-words">Top 25 Words</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Library of Congress staff
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <header class="loc-header">
    <div class="loc-logo">
        <a href="https://www.loc.gov/"><img src="/data-exploration/_static/LOC_Logo_horiz_inv.png" alt="The Library of Congress logo" title="Go to the Library of Congress homepage" /></a>
    </div>
    <div class="project-description">
        <p>In-depth tutorials for working with Library of Congress data via APIs and code. <a href="https://github.com/libraryOfCongress/data-exploration/" class="button small">View the code</a></p>
    </div>
</header>
<footer class="loc-footer">
    <p>In-depth tutorials for working with Library of Congress data via APIs and code.</p>
    <ul class="loc-footer-nav-list">
        <li><a href="https://github.com/libraryOfCongress/data-exploration/">Source code</a></li>  
        <li><a href="https://www.loc.gov/">The Library of Congress</a></li>
        <li><a href="https://loc.gov/legal">Privacy Policy</a></li>
        <li><a href="https://www.loc.gov/accessibility/">Accessibilty</a></li>
        <li><a href="https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement">Github Privacy Statement</a></li>
        <li><a href="https://creativecommons.org/publicdomain/zero/1.0/">License</a></li>
        <li><a href="mailto:LC-Labs@loc.gov">Contact</a></li>
    </ul>
</footer>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>